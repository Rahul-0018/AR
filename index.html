<!DOCTYPE html>
<html>
  <head>
    <title>AR.js Damaged Helmet (Rear Camera + Tap Placement)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #logBox {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        color: #0f0;
        padding: 10px;
        font-family: monospace;
        font-size: 14px;
        max-width: 90%;
        max-height: 50%;
        overflow-y: auto;
        z-index: 9999;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div id="logBox">ðŸ“‹ Logs:<br></div>
    <a-scene embedded vr-mode-ui="enabled: false"
             arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false;">
      <a-entity camera></a-entity>
      <a-entity id="helmet"
        gltf-model="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf"
        scale="2 2 2"
        position="0 0 -3"
        rotation="0 180 0">
      </a-entity>
    </a-scene>
    <script>
      const logBox = document.getElementById("logBox");
      function addLog(msg) {
        console.log(msg);
        logBox.innerHTML += msg + "<br>";
        logBox.scrollTop = logBox.scrollHeight;
      }
      addLog("ðŸš€ App started, requesting REAR camera...");

      const helmet = document.getElementById("helmet");
      helmet.addEventListener("model-loaded", () =>
        addLog("âœ… Model loaded (Damaged Helmet) & placed 3m in front of camera")
      );
      helmet.addEventListener("model-error", e =>
        addLog("âŒ Model failed: " + JSON.stringify(e.detail))
      );

      window.addEventListener("click", () => {
        const camera = document.querySelector('[camera]');
        const direction = new THREE.Vector3();
        camera.object3D.getWorldDirection(direction);

        const cameraPosition = camera.object3D.position;
        const newPos = {
          x: cameraPosition.x + direction.x * 2,
          y: cameraPosition.y + direction.y * 2,
          z: cameraPosition.z + direction.z * 2,
        };
        helmet.setAttribute("position", newPos);
        addLog("ðŸ‘† Tap detected. Helmet moved to: " + JSON.stringify(newPos));
      });
    </script>
  </body>
</html>
